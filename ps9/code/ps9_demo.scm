;;; Problem 8.2b
(load "load")
(init)
(define x 3)

(define foo (alpha (a) (if (= x 2) (display 'ha) (display 'oh))))
(pp x)
;; 3
(stop-time-sharing)
(foo (set! x 2))
;; actor-applied
(pp x)
;; 2  <== argument was evaluated, even though actor wasn't run
(start-time-sharing)
;; ha
(load "ps9_code")
(set! x 3)
(pp x)
;; 3
(stop-time-sharing)
(foo (set! x 2))
;; actor-applied
(pp x)
;; 3
(start-time-sharing)
;; ha
(pp x)
;; 2

;;; Problem 8.4
(fib1 5 write-line)
;; actor-applied
;;
;; eval> (run (cont))
;; (run (2 1))
;; (run (1 cont 1))
;; (run (cont 3 1))
;; (run (3 1 1))
;; (run (1 1 cont 2))
;; (run (1 cont 4 1))
;; (run (cont 4 1 1))
;; (run (4 1 1 1))
;; (run (1 1 1 cont 3))
;; (run (1 1 cont 5 1))
;; (run (1 cont 5 1 1))
;; (run (cont 5 1 1 1))
;; (run (5 1 1 1 1))
;; (run (1 1 1 1 cont 4))
;; (run (1 1 1 cont 6 1))
;; (run (1 1 cont 6 1 1))
;; (run (1 cont 6 1 1 1))
;; (run (cont 6 1 1 1 1))
;; (run (6 1 1 1 1 1))
;; (run (1 1 1 1 1 cont 5))
;; (run (1 1 1 1 cont 7 1))
;; (run (1 1 1 cont 7 1 1))
;; (run (1 1 cont 7 1 1 1))
;; (run (1 cont 7 1 1 1 1))
;; (run (cont 7 1 1 1 1 1))
;; (run (7 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 cont 6))
;; (run (1 1 1 1 1 cont 6))
;; (run (1 1 1 1 cont 6 1))
;; (run (1 1 1 cont 6 1 1))
;; (run (1 1 cont 6 1 1 1))
;; (run (1 cont 6 1 1 1 1))
;; (run (cont 6 1 1 1 1 1))
;; (run (6 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 cont 5))
;; (run (1 1 1 1 1 cont 7 1))
;; (run (1 1 1 1 cont 7 1 1))
;; (run (1 1 1 cont 7 1 1 1))
;; (run (1 1 cont 7 1 1 1 1))
;; (run (1 cont 7 1 1 1 1 1))
;; (run (cont 7 1 1 1 1 1 1))
;; (run (7 1 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 1 cont 6))
;; (run (1 1 1 1 1 1 cont 6))
;; (run (1 1 1 1 1 cont 6 1))
;; (run (1 1 1 1 cont 6 1 1))
;; (run (1 1 1 cont 6 1 1 1))
;; (run (1 1 cont 6 1 1 1 1))
;; (run (1 cont 6 1 1 1 1 1))
;; (run (cont 6 1 1 1 1 1 1))
;; (run (6 1 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 1 cont 5))
;; (run (1 1 1 1 1 1 cont 5))
;; (run (1 1 1 1 1 cont 5 1))
;; (run (1 1 1 1 cont 5 1 1))
;; (run (1 1 1 cont 5 1 1 1))
;; (run (1 1 cont 5 1 1 1 1))
;; (run (1 cont 5 1 1 1 1 1))
;; (run (cont 5 1 1 1 1 1 1))
;; (run (5 1 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 1 cont 4))
;; (run (1 1 1 1 1 1 cont 4))
;; (run (1 1 1 1 1 cont 4 1))
;; (run (1 1 1 1 cont 4 1 1))
;; (run (1 1 1 cont 4 1 1))
;; (run (1 1 cont 4 1 1 1))
;; (run (1 cont 4 1 1 1 1))
;; (run (cont 4 1 1 1 1 1))
;; (run (4 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 cont 3))
;; (run (1 1 1 1 1 cont 3))
;; (run (1 1 1 1 cont 3 1))
;; (run (1 1 1 cont 3 1 1))
;; (run (1 1 cont 3 1 1 1))
;; (run (1 cont 3 1 1 1 1))
;; (run (cont 3 1 1 1 1 1))
;; (run (3 1 1 1 1 1 1))
;; (run (1 1 1 1 1 1 cont 2))
;; (run (1 1 1 1 1 cont 2))
;; (run (1 1 1 1 cont 2 1))
;; (run (1 1 1 cont 2 1))
;; (run (1 1 cont 2 1 1))
;; (run (1 cont 2 1 1))
;; (run (cont 2 1 1 1))
;; (run (2 1 1 1 1))
;; (run (1 1 1 1 cont 1))
;; (run (1 1 1 cont 1))
;; (run (1 1 cont 1 1))
;; (run (1 cont 1 1 1))
;; (run (cont 1 1 1 1))
;; (run (1 1 1 1 1))
;; (run (1 1 1 1 cont))
;; (run (1 1 1 cont))
;; (run (1 1 cont))
;; (run (1 cont))
;; (run (cont))
;; 5

(fib2 5 write-line)
;; actor-applied
;;
;; eval> (run (cont))
;; (run (2))
;; (run (cont 1))
;; (run (3))
;; (run (cont 2))
;; (run (4))
;; (run (cont 3))
;; (run (5))
;; (run (cont 4))
;; (run (6))
;; (run (cont 5))
;; (run (7))
;; (run (cont 6))
;; (run (6))
;; (run (cont 5))
;; (run (7))
;; (run (cont 6))
;; (run (6))
;; (run (cont 5))
;; (run (5))
;; (run (cont 4))
;; (run (4))
;; (run (cont 3))
;; (run (3))
;; (run (cont 2))
;; (run (2))
;; (run (cont 1))
;; (run (1))
;; (run (cont))
;; 5
